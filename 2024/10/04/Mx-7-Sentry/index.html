<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MX_7 Sentry, Dingling Luo&#39;s Blog">
    <meta name="description" content="test">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>MX_7 Sentry | Dingling Luo&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Dingling Luo&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Dingling Luo&#39;s Blog</div>
        <div class="logo-desc">
            
            test
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MX_7 Sentry</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Robotics/">
                                <span class="chip bg-color">Robotics</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-10-04
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Robot-Design｜MX-7-Sentry"><a href="#Robot-Design｜MX-7-Sentry" class="headerlink" title="# Robot Design｜MX_7_Sentry"></a># Robot Design｜MX_7_Sentry</h1><p> A comprehensive introduction to MX_7 Sentry from the perspectives of design background, design metrics, mechanical design, hardware design, and software design</p>
<blockquote><p>This is a robot designed for the RoboMaster competition, <strong>and I completed the structural design, fabrication and assembly of it, and also completed the embedded code design and debugging of its motion control.</strong></p>
</blockquote>

<h1 id="Introduction-to-Robot-Design-Background"><a href="#Introduction-to-Robot-Design-Background" class="headerlink" title="Introduction to Robot Design Background"></a>Introduction to Robot Design Background</h1><p>The mission of the Sentinel Robot has changed from “the last line of defense at the gate of the base” from last season to <strong>“a fully automatic robot equipped with the most firepower”</strong>.<br>Sentries are invincible until the outpost is destroyed, and allows for two muzzles with a very high rate of fire, making the sentry invincible early in the match.This makes the Sentinel much more aggressive.The Sentinel needs to go out to attack the opponent’s robot, and since the Sentinel is a fully automatic robot, it needs to be equipped with map-aware sensors, navigation algorithms, and an automatic aiming transmitter mechanism. We used a combination of lidar and gyroscope to navigate and correct the robot’s position. Use industrial cameras to find each other’s location and lock onto each other. It is also equipped with gravity and distance compensation algorithms to correct the trajectory of the attack to improve the hit rate.</p>
<h1 id="Robot-Design-Metrics"><a href="#Robot-Design-Metrics" class="headerlink" title="Robot Design Metrics"></a>Robot Design Metrics</h1><h2 id="Sentinel-Robot’s-function"><a href="#Sentinel-Robot’s-function" class="headerlink" title="Sentinel Robot’s function"></a>Sentinel Robot’s function</h2><h3 id="Chassis-function-design"><a href="#Chassis-function-design" class="headerlink" title="Chassis function design"></a>Chassis function design</h3><ul>
<li>There will be no rollover in all terrains <ul>
<li>Control the height of the center of gravity</li>
<li>Maximum track width</li>
</ul>
</li>
<li>Strong mobility</li>
<li>Mecanum wheel design</li>
<li>Reduce gimbal shake to enhance aiming<ul>
<li>Has a four-wheel independent suspension system</li>
</ul>
</li>
</ul>
<h3 id="Gimbal-functional-design"><a href="#Gimbal-functional-design" class="headerlink" title="Gimbal functional design"></a>Gimbal functional design</h3><ul>
<li>Twin firing mechanisms<ul>
<li>One dial and two muzzles are used to reduce the weight of the gimbal and calculate the muzzle heat and cooling separately.</li>
<li>The gimbal and the chassis are connected by slip rings in the middle, so that the gimbal can lock the opponent’s robot while the chassis rotates.</li>
<li>he magazine is arranged in the chassis, and the projectile track passes through the relative center of rotation of the gimbal and the chassis to ensure that the projectile can be fired smoothly during the rotation of the chassis.</li>
</ul>
</li>
</ul>
<h3 id="Other-functions"><a href="#Other-functions" class="headerlink" title="Other functions"></a>Other functions</h3><ul>
<li>Easy to maintain<ul>
<li>Small module damage can be repaired within 2 minutes</li>
<li>Large module damage can be repaired within 3 minutes</li>
<li>Use m4 screws and nuts as far as possible to facilitate replacement and maintenance</li>
</ul>
</li>
<li>High stability, not easy to damage</li>
<li>The overall shape is elegent and generous</li>
</ul>
<h3 id="Examples-of-functional-quantification"><a href="#Examples-of-functional-quantification" class="headerlink" title="Examples of functional quantification"></a>Examples of functional quantification</h3><ul>
<li>Five consecutive 0.4-meter free-fall robot structures were not damaged.</li>
<li>Barrel switching in 15 seconds and 20 consecutive switching without stuttering and misalignment.</li>
<li>If you fire 1000 rounds of 10 shots in a row, the probability of jamming is less than 0.2%, if you get stuck, the dial can be automatically flipped and re-fired.</li>
<li>Ability to build a site map with lidar and follow a projected route.</li>
</ul>
<h3 id="Official-requirements-of-the-competition"><a href="#Official-requirements-of-the-competition" class="headerlink" title="Official requirements of the competition"></a>Official requirements of the competition</h3><ul>
<li>The maximum length, width and height(mm) is less than 600</li>
</ul>
<h1 id="Introduction-to-Mechanical-Structure-Design"><a href="#Introduction-to-Mechanical-Structure-Design" class="headerlink" title="Introduction to Mechanical Structure Design"></a>Introduction to Mechanical Structure Design</h1><p><img src="/../images/%E5%93%A8%E5%85%B5%E7%BA%BF%E7%A8%BF%EF%BC%88%E7%99%BD%E5%BA%95%E9%BB%91%E7%BA%BF%EF%BC%89.png" alt="Sentinel robot blueprint"><br><img src="/../images/MX_7_Sentry.jpg" alt="Real photo of the Sentinel robot"><br><img src="/../images/2023%E5%93%A8%E5%85%B5%E5%AE%9E%E7%89%A9.jpg" alt="Sentinel robot on the field"></p>
<h2 id="Model-files"><a href="#Model-files" class="headerlink" title="Model files"></a>Model files</h2><p>Final assembly model link: <a target="_blank" rel="noopener" href="https://a360.co/3TWUdwV">https://a360.co/3TWUdwV</a></p>
<h2 id="Code-files"><a href="#Code-files" class="headerlink" title="Code files"></a>Code files</h2><p>The code can be found at:<a target="_blank" rel="noopener" href="https://github.com/DinglingLuo/RM-MX_7_Sentry">https://github.com/DinglingLuo/RM-MX_7_Sentry</a></p>
<h2 id="Chassis-Layout"><a href="#Chassis-Layout" class="headerlink" title="Chassis Layout"></a>Chassis Layout</h2><p>The chassis layout of Sentinel Robot adopts the conventional four-mecanum wheel layout. Compared with the four-omnidirectional wheel layout, the robot in this layout has a faster linear motion speed under the same power and load. If the omnidirectional wheels move in a 45° direction, then Under heavy load, the damage to the two motors is slightly greater, and the other two wheels also provide a certain amount of friction, especially on undulating roads, which will seriously affect the movement; compared with the steering wheel, the wheelbase in the same frame is larger, and it is less prone to overturning , and the chassis load is reduced, and the speed of acceleration and operation is faster, which is more conducive to the tactical significance of Sentinel Robot.</p>
<h3 id="Chassis-suspension-design"><a href="#Chassis-suspension-design" class="headerlink" title="Chassis suspension design"></a>Chassis suspension design</h3><p>This robot is based on the 2021 Harbin Institute of Technology’s steering wheel infantry robot, using vertical suspension. The curve of the vertical displacement of the wheel and the compression of the spring is a curve with a decreasing slope. In some cases, it has been tested that the landing step impact may cause structural damage to the wheel train without a specific impact design.<br>So the question arises, how to get a curve with an increasing slope in the suspension position of the parallelogram. The answer is that the parallelogram suspension hinge is connected to the shock absorber, and the angle to the shock absorber increases during compression, and approaches the right angle or reaches the right angle (as shown below), which can achieve the desired effect.<br><img src="/../images/%E5%B9%B3%E8%A1%8C%E5%9B%9B%E8%BE%B9%E5%BD%A2%E8%BF%9E%E6%9D%86%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Schematic diagram of the location of the parallelogram shock"></p>
<h2 id="Gimbal-Layout"><a href="#Gimbal-Layout" class="headerlink" title="Gimbal Layout"></a>Gimbal Layout</h2><p>The Sentinel Robot places the magazine in the chassis, and the projectile passage passes through the center of connection between the gimbal and the chassis to the launch port above. The Sentinel is equipped with two launchers, one of which can be switched to the other if it overheats, greatly improving the Sentinel’s ability to continuously attack enemy robots.<br><img src="/../images/%E5%8F%8C%E6%9E%AA%E7%AE%A1.png" alt="Dual-firing mechanism design"></p>
<h3 id="Gimbal-linkage-design"><a href="#Gimbal-linkage-design" class="headerlink" title="Gimbal linkage design"></a>Gimbal linkage design</h3><p>During the design process, the inertia of the pitch axis should be reduced as much as possible to reduce the load on the motor and speed up the response speed. Therefore, the motor is moved under the pitch axis and connected by connecting rods.<br>And by controlling the angle of the motor, you can directly control the pitch angle of the gimbal.<br><img src="/../images/%E4%BA%91%E5%8F%B0%E8%BF%9E%E6%9D%86%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Schematic diagram of the gimbal linkage"></p>
<p><img src="/../images/%E4%BE%9B%E7%94%B5%E7%B3%BB%E7%BB%9F%E6%A1%86%E5%9B%BE.png" alt="Block diagram of robot power supply system"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>2023哨兵底盘为麦轮结构，在2023对抗赛时期拥有了两个发射机构，一个上供弹，一个下供弹，配备一个nuc和激光雷达Mid360，，2023对抗赛时期拥有自瞄，但无法实现导航。<br><img src="/../images/2023%E5%93%A8%E5%85%B5%E5%AE%9E%E7%89%A9.jpg" alt="image"></p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>底盘能够实现全向移动，能够实现底盘跟随，小陀螺移动等基本功能，有多层底盘功率控制算法，能够做到利用缓冲能量而不超限；云台和底盘各配备一个C板，能够实现云台的基本功能，如发射，云台控制等，有裁判系统通信，上下位机通信，自瞄等功能，如今已加入新的弹道补偿。下图是2023哨兵功能图纸。<br><img src="/../images/2023%E5%93%A8%E5%85%B5%E5%8A%9F%E8%83%BD%E5%9B%BE.jpg" alt="image"></p>
<h2 id="缺陷与不足"><a href="#缺陷与不足" class="headerlink" title="缺陷与不足"></a>缺陷与不足</h2><p>1.Pitch的重量和连杆结构导致不知名错误，Pitch会时而抖动，找不到原因，只使用一个电机时会有所缓解抖动，但控制力矩不够，稳态误差较大。<br>2.没有枪口热量的函数控制代码。<br>3.自瞄在追踪动态目标的效果不好，目前仍在调试中。<br>4.无法导航，目前仍在调试中。</p>
<h1 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h1><p>##走线<br><img src="/../images/2023%E5%93%A8%E5%85%B5%E6%8E%A5%E7%BA%BF%E5%9B%BE.png" alt="image"></p>
<h2 id="底盘C板"><a href="#底盘C板" class="headerlink" title="底盘C板"></a>底盘C板</h2><p>所有自己写的东西都存放在&#x2F;User里面，User下主要有4个文件夹，下面对这4个文件夹分别进行介绍<br>1.<strong>&#x2F;AlgorithmLayer</strong>   一些控制函数<br>2.<strong>&#x2F;DriverLayer</strong>  硬件自定义配置<br>3.<strong>&#x2F;PotocaLayer</strong>  通信函数相关<br>4.<strong>&#x2F;Task</strong> 各种任务</p>
<h3 id="AlgorithmLayer"><a href="#AlgorithmLayer" class="headerlink" title="&#x2F;AlgorithmLayer"></a>&#x2F;AlgorithmLayer</h3><p>包括PID函数库，电机结构体，IMU驱动函数，裁判系统CRC校验。</p>
<h3 id="DriverLayer"><a href="#DriverLayer" class="headerlink" title="&#x2F;DriverLayer"></a>&#x2F;DriverLayer</h3><p>包括BMI088启动的自定义硬件配置，自定义的Can通信配置，自定义的usart通信配置(裁判系统和遥控器)。</p>
<h3 id="PotocaLayer"><a href="#PotocaLayer" class="headerlink" title="&#x2F;PotocaLayer"></a>&#x2F;PotocaLayer</h3><p>rc_potocal.c是遥控器解算函数。<br>judge.c是裁判系统解算函数，其中包含了取出自定义的裁判系统更新函数，用于做导航决策树。</p>
<h3 id="Task"><a href="#Task" class="headerlink" title="&#x2F;Task"></a>&#x2F;Task</h3><p>主要任务只有两个：<br>1.麦轮底盘控制任务<br>包括：遥控器信息转换，麦轮解算，期望速度限制，功率限制和分配，电机发送。<br>2.IMU任务<br>用来读取BMI088的6轴数据并解算出姿态，用的是3号的陀螺仪代码。</p>
<h3 id="stm32f4xx-it-c"><a href="#stm32f4xx-it-c" class="headerlink" title="stm32f4xx_it.c"></a>stm32f4xx_it.c</h3><p>需要指出的是，均将中断调用(除can)写进了stm32f4xx_it.c函数中。</p>
<h2 id="云台C板"><a href="#云台C板" class="headerlink" title="云台C板"></a>云台C板</h2><p>和底盘C板一样，云台C板的构架也是一样：<br>1.<strong>&#x2F;AlgorithmLayer</strong>   一些控制函数<br>2.<strong>&#x2F;DriverLayer</strong>  硬件自定义配置<br>3.<strong>&#x2F;PotocaLayer</strong>  通信函数相关<br>4.<strong>&#x2F;Task</strong> 各种任务</p>
<h3 id="AlgorithmLayer-1"><a href="#AlgorithmLayer-1" class="headerlink" title="&#x2F;AlgorithmLayer"></a>&#x2F;AlgorithmLayer</h3><p>包括PID函数库，电机结构体，IMU驱动函数，自瞄解算函数，其中包含了Pitch的弹道补偿和对接上位机的解算代码和决策代码。</p>
<h3 id="DriverLayer-1"><a href="#DriverLayer-1" class="headerlink" title="&#x2F;DriverLayer"></a>&#x2F;DriverLayer</h3><p>包括BMI088启动的自定义硬件配置，自定义的Can通信配置(过滤器及接收中断回调)。</p>
<h3 id="PotocaLayer-1"><a href="#PotocaLayer-1" class="headerlink" title="&#x2F;PotocaLayer"></a>&#x2F;PotocaLayer</h3><p>remote_control.c是遥控器解算函数。(注意底盘代码是参考深大的，云台的这个参考官方的)<br>MX_FREERTOS_init.c是自定义的freertos初始化函数</p>
<h3 id="Task-1"><a href="#Task-1" class="headerlink" title="&#x2F;Task"></a>&#x2F;Task</h3><p>主要任务有5个：<br>1.Yaw_task<br>Yaw轴电机控制任务，反馈值用的IMU航向角，其中有调试模式和上场模式，自带自瞄。</p>
<p>2.Pitch_task<br>双电机Pitch控制任务，用的其中一个电机进行解算，另一个电机直接赋相同的值(符号相反)。</p>
<p>3.Friction_task<br>发射机构任务，其中包含4个摩擦轮和两个拨盘，拨盘反转功能由于重写而未验证。</p>
<p>4.INS_task<br>IMU解算任务，用的3号IMU代码，和底盘C板同款。</p>
<p>5.Exchange_task<br>通信任务，用来存放了底盘和云台C板通信，自瞄通信的代码。</p>
<h3 id="stm32f4xx-it-c-1"><a href="#stm32f4xx-it-c-1" class="headerlink" title="stm32f4xx_it.c"></a>stm32f4xx_it.c</h3><p>需要指出的是，均将中断调用(除can)写进了stm32f4xx_it.c函数中。</p>
<p><strong>注：很多功能函数都直接放在了任务的文件里面，并没有分配到各个功能文件中去。</strong></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Dingling Luo</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://dinglingluo.github.io/2024/10/04/Mx-7-Sentry/">https://dinglingluo.github.io/2024/10/04/Mx-7-Sentry/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Dingling Luo</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Robotics/">
                                    <span class="chip bg-color">Robotics</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/10/06/MechaX-US/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="MechaX_US">
                        
                        <span class="card-title">MechaX_US</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-10-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Dingling Luo
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Robotics/">
                        <span class="chip bg-color">Robotics</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/10/04/MechaX/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="MechaX">
                        
                        <span class="card-title">MechaX</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-10-04
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Dingling Luo
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Robotics/">
                        <span class="chip bg-color">Robotics</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">Dingling Luo</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
